/* socket 2017-12-08 */

var socket,Chat={};Chat.init=function(e){(socket=new io.connect(e.host)).on("meesage",function(t){e.dom.count.text(t.clients)}),Chat.username=Chat.getUsername(),Chat.messages=new Chat.Messages,Chat.messagesView=new Chat.MessagesView({collection:Chat.messages}),e.dom.form.submit(Chat.submit),Chat.$chatroom=e.dom.room,socket.on("chat",Chat.addMessage)},Chat.getUsername=function(){return prompt("What's your name?","")||"Anonymous"},Chat.submit=function(e){e.preventDefault();var t=$(e.target.message),a=t.val();t.val(""),socket.emit("newchat",{name:Chat.username,text:a})},Chat.Message=Backbone.Model.extend({text:""}),Chat.Messages=Backbone.Collection.extend({model:Chat.Message}),Chat.MessageView=Backbone.View.extend({tagName:"p",render:function(){var e=JST["public/templates/src/username"](this.model.toJSON());return this.$el.html(e),this.parentView.$el.append(this.$el),this}}),Chat.MessagesView=Backbone.View.extend({el:"#chatroom",initialize:function(){_.bindAll(this,"render"),this.collection.on("change",this.render),this.collection.on("add",this.render),this.collection.on("remove",this.render)},render:function(){return this.$el.empty(),this.collection.each(function(e){var t=new Chat.MessageView({model:e});t.parentView=this,t.render()},this),this.$el.animate({scrollTop:this.$el.height()},100),this}}),Chat.addMessage=function(e){Chat.messages.add(e)},$(function(){Chat.init({host:"http://localhost:3000",dom:{count:$("#client-count"),form:$(".chatbox"),room:$("#chatroom")}})});